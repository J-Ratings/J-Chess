  <!-- chess.js for move legality -->
  <script src="https://cdn.jsdelivr.net/npm/chess.js@0.13.4/chess.min.js"></script>

  <script>
    let board, game;

    function onDragStart(source, piece) {
      // don't pick up pieces if the game is over or it's not White to move
      if (game.game_over() || (game.turn() === 'w' && piece[0] !== 'w') || (game.turn() === 'b' && piece[0] !== 'b')) {
        return false;
      }
    }

    function onDrop(source, target) {
      // see if the move is legal
      const move = game.move({
        from: source,
        to: target,
        promotion: 'q' // always promote to queen for simplicity
      });

      // illegal move
      if (move === null) return 'snapback';

      // legal: update board and status
      board.position(game.fen());
      return;
    }

    function onSnapEnd() {
      // update the board to reflect the game state
      board.position(game.fen());
    }

    $(function() {
      // initialise a new game from the standard start position
      game = new Chess();  

      board = Chessboard('board', {
        position: 'start',
        draggable: true,
        onDragStart: onDragStart,
        onDrop:      onDrop,
        onSnapEnd:   onSnapEnd,
        pieceTheme: 'chessboardjs-1.0.0/img/chesspieces/wikipedia/{piece}.png'
      });
    });
  </script>
